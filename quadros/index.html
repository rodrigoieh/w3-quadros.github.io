<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=620, user-scalable=0">
    <link rel="stylesheet" href="../resources/css/quadros.css"/>
    <!-- Favicon { -->
    <link rel="apple-touch-icon" sizes="180x180" href="../resources/media/favicon/apple-touch-icon.png?v=1.0.0">
    <link rel="icon" type="image/png" sizes="32x32" href="../resources/media/favicon/favicon-32x32.png?v=1.0.0">
    <link rel="icon" type="image/png" sizes="194x194" href="../resources/media/favicon/favicon-194x194.png?v=1.0.0">
    <link rel="icon" type="image/png" sizes="192x192"
          href="../resources/media/favicon/android-chrome-192x192.png?v=1.0.0">
    <link rel="icon" type="image/png" sizes="16x16" href="../resources/media/favicon/favicon-16x16.png?v=1.0.0">
    <link rel="manifest" href="../resources/media/favicon/site.webmanifest?v=1.0.0">
    <link rel="mask-icon" href="../resources/media/favicon/safari-pinned-tab.svg?v=1.0.0" color="#b15300">
    <link rel="shortcut icon" href="../resources/media/favicon/favicon.ico?v=1.0.0">
    <meta name="apple-mobile-web-app-title" content="Quadros">
    <meta name="application-name" content="Quadros">
    <meta name="msapplication-TileColor" content="#b15300">
    <meta name="msapplication-config" content="resources/media/favicon/browserconfig.xml">
    <meta name="theme-color" content="#b15300">
    <!-- Favicon } -->
    <title>quadros</title>
    <style>
        #previews {
            width: 100%;
        }

        img {
            filter: grayscale(70%);
        }

        img:hover {
            filter: grayscale(0%);
        }
    </style>
</head>
<body>
<div id="main">
    <div id="error"></div>
    <div id="previews"></div>
    <div class="light" id="index" style="display: none"></div>
</div>
<script src="../resources/js/quadros.style.js"></script>
<script src="../resources/js/quadros.commons.js"></script>
<script src="../resources/js/quadros.index.js"></script>
<script>document.body.style.zoom = '80%';</script>
<script>
    try {
        const jsHeapSizeLimit = window.performance.memory.jsHeapSizeLimit;
        debug(jsHeapSizeLimit);
    } catch (error) {
        console.error(error);
    }

    class Quadro {
        constructor(id, type, path, preview, filename, extension, directory, visible) {
            this.id = id;
            this.type = type;
            this.path = path;
            this.preview = preview;
            this.filename = filename;
            this.extension = extension;
            this.directory = directory;
            this.visible = visible;
        }

        static class(object) {
            return new Quadro(
                object.id, object.type, object.path,
                object.preview, object.filename, object.extension,
                object.directory, object.visible);
        }
    }

    const getElementAnchor = (id, href, title = id) => {
        let a = document.createElement('a');
        a.id = `preview-a-${id}`;
        a.title = title;
        a.href = '/'.concat(href);
        return a;
    }

    const getElementImage = (id, src, width = 150, height = 150) => {
        let img = document.createElement('img');
        img.id = `preview-img-${id}`;
        img.src = src;
        img.alt = id;
        img.width = width;
        img.height = height;
        img.style.margin = 'auto';
        img.style.cursor = 'zoom-in';
        img.style.backgroundColor = 'hsl(0, 0%, 90%)';
        img.style.transition = 'background-color 300ms';
        img.style.webkitUserSelect = 'none';
        return img;
    };

    let previews = document.getElementById('previews');
    const directories = index.collection.reverse();
    for (const directory of directories) {
        const quadros = directory.collection;
        if (quadros !== undefined) {
            const k = quadros.length;
            for (let i = k - 1; i > 0; i--) {
                const quadro = Quadro.class(quadros[i]);
                if (quadro.visible) {
                    let a = getElementAnchor(quadro.id, quadro.path);
                    const image = getElementImage(quadro.id, quadro.preview);
                    a.appendChild(image);
                    previews.appendChild(a);
                }
            }
        }
    }
</script>
</body>
</html>
